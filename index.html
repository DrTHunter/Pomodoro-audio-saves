<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Productivity Tracker</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cae;
            --accent-color: #ff7e5f;
            --light-bg: #f8f9fa;
            --dark-text: #333;
            --light-text: #fff;
            --border-color: #ddd;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-bg);
            color: var(--dark-text);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1, h2, h3 {
            color: var(--primary-color);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid var(--border-color);
            border-bottom: none;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background-color: var(--primary-color);
            color: var(--light-text);
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background-color: white;
            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .project-list {
            margin-bottom: 20px;
        }
        
        .project-item {
            padding: 15px;
            border: 1px solid var(--border-color);
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .project-info {
            flex: 1;
        }
        
        .project-actions {
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 8px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: var(--secondary-color);
        }
        
        button.secondary {
            background-color: var(--border-color);
            color: var(--dark-text);
        }
        
        button.danger {
            background-color: #dc3545;
        }
        
        button.success {
            background-color: #28a745;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--secondary-color);
        }
        
        .time-period-selector {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .time-period-selector button {
            flex: 1;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        th {
            background-color: var(--primary-color);
            color: white;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        tr:hover {
            background-color: #e9e9e9;
        }
        
        .chart-container {
            height: 400px;
            margin-bottom: 30px;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
        }
        
        .export-options {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        
        .date-range-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .date-range-selector label {
            margin-bottom: 0;
            white-space: nowrap;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 5px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .close-modal {
            font-size: 24px;
            cursor: pointer;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            font-size: 12px;
            color: var(--dark-text);
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .time-period-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Project Productivity Tracker</h1>
        
        <div class="tabs">
            <div class="tab active" data-tab="projects">Projects</div>
            <div class="tab" data-tab="dashboard">Dashboard</div>
            <div class="tab" data-tab="reports">Reports</div>
        </div>
        
        <!-- Projects Tab -->
        <div id="projects" class="tab-content active">
            <h2>Manage Projects</h2>
            
            <button id="add-project-btn">Add New Project</button>
            
            <div class="project-list" id="project-list">
                <!-- Projects will be loaded here -->
            </div>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <h2>Productivity Dashboard</h2>
            
            <div class="time-period-selector">
                <button class="active" data-period="day">Daily</button>
                <button data-period="week">Weekly</button>
                <button data-period="month">Monthly</button>
                <button data-period="custom">Custom Range</button>
            </div>
            
            <div class="date-range-selector" id="custom-date-range" style="display: none;">
                <label for="start-date">From:</label>
                <input type="date" id="start-date">
                <label for="end-date">To:</label>
                <input type="date" id="end-date">
                <button id="apply-date-range">Apply</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Projects</div>
                    <div class="stat-value" id="total-projects">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Active Projects</div>
                    <div class="stat-value" id="active-projects">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Hours Worked</div>
                    <div class="stat-value" id="hours-worked">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Tasks Completed</div>
                    <div class="stat-value" id="tasks-completed">0</div>
                </div>
            </div>
            
            <h3>Project Progress</h3>
            <div class="chart-container" id="progress-chart">
                <!-- Chart will be rendered here -->
                <p>Project progress chart will appear here</p>
            </div>
            
            <h3>Recent Activity</h3>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Project</th>
                        <th>Activity</th>
                        <th>Time Spent</th>
                    </tr>
                </thead>
                <tbody id="recent-activity">
                    <!-- Recent activity will be loaded here -->
                </tbody>
            </table>
        </div>
        
        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2>Generate Reports</h2>
            
            <div class="form-group">
                <label for="report-project">Select Project:</label>
                <select id="report-project">
                    <option value="all">All Projects</option>
                    <!-- Projects will be loaded here -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="report-period">Time Period:</label>
                <select id="report-period">
                    <option value="week">Last 7 Days</option>
                    <option value="month">Last 30 Days</option>
                    <option value="quarter">Last 90 Days</option>
                    <option value="year">Last 12 Months</option>
                    <option value="custom">Custom Range</option>
                </select>
            </div>
            
            <div class="date-range-selector" id="report-date-range" style="display: none;">
                <label for="report-start-date">From:</label>
                <input type="date" id="report-start-date">
                <label for="report-end-date">To:</label>
                <input type="date" id="report-end-date">
            </div>
            
            <div class="form-group">
                <label for="report-detail">Detail Level:</label>
                <select id="report-detail">
                    <option value="summary">Summary</option>
                    <option value="detailed">Detailed</option>
                </select>
            </div>
            
            <div class="export-options">
                <button id="preview-report">Preview Report</button>
                <button id="export-word">Export to Word</button>
                <button id="export-pdf">Export to PDF</button>
                <button id="export-csv">Export to CSV</button>
            </div>
            
            <div id="report-preview" style="margin-top: 30px; display: none;">
                <h3>Report Preview</h3>
                <div id="report-content" style="background-color: white; padding: 20px; border: 1px solid var(--border-color); border-radius: 5px;">
                    <!-- Report preview will be shown here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit Project Modal -->
    <div id="project-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add New Project</h2>
                <span class="close-modal">&times;</span>
            </div>
            <form id="project-form">
                <input type="hidden" id="project-id">
                <div class="form-group">
                    <label for="project-name">Project Name</label>
                    <input type="text" id="project-name" required>
                </div>
                <div class="form-group">
                    <label for="project-description">Description</label>
                    <textarea id="project-description"></textarea>
                </div>
                <div class="form-group">
                    <label for="project-start-date">Start Date</label>
                    <input type="date" id="project-start-date" required>
                </div>
                <div class="form-group">
                    <label for="project-due-date">Due Date (optional)</label>
                    <input type="date" id="project-due-date">
                </div>
                <div class="form-group">
                    <label for="project-status">Status</label>
                    <select id="project-status">
                        <option value="not-started">Not Started</option>
                        <option value="in-progress">In Progress</option>
                        <option value="on-hold">On Hold</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="project-priority">Priority</label>
                    <select id="project-priority">
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Progress</label>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-visual" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="progress-text">0%</div>
                    <input type="range" id="project-progress" min="0" max="100" value="0">
                </div>
                <button type="submit" class="success">Save Project</button>
            </form>
        </div>
    </div>
    
    <!-- Report Preview Modal -->
    <div id="report-modal" class="modal">
        <div class="modal-content" style="width: 90%; max-width: 800px;">
            <div class="modal-header">
                <h2>Project Productivity Report</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div id="full-report-content" style="padding: 20px; background-color: white; border-radius: 5px;">
                <!-- Full report content will be shown here -->
            </div>
            <div class="export-options" style="margin-top: 20px;">
                <button id="print-report">Print Report</button>
                <button id="download-word">Download Word</button>
                <button id="download-pdf">Download PDF</button>
            </div>
        </div>
    </div>

    <script>
        // Sample data structure
        let projects = [
            {
                id: 1,
                name: "Website Redesign",
                description: "Complete redesign of company website with new features",
                startDate: "2023-05-15",
                dueDate: "2023-08-30",
                status: "in-progress",
                priority: "high",
                progress: 45,
                tasks: [
                    { id: 1, name: "Design mockups", completed: true, timeSpent: 12 },
                    { id: 2, name: "Frontend development", completed: true, timeSpent: 40 },
                    { id: 3, name: "Backend integration", completed: false, timeSpent: 25 },
                    { id: 4, name: "Content migration", completed: false, timeSpent: 0 },
                    { id: 5, name: "Testing", completed: false, timeSpent: 0 }
                ],
                activities: [
                    { date: "2023-06-10", activity: "Completed design mockups", time: 2 },
                    { date: "2023-06-12", activity: "Started frontend development", time: 4 },
                    { date: "2023-06-15", activity: "Frontend development", time: 6 },
                    { date: "2023-06-18", activity: "Client review meeting", time: 1 },
                    { date: "2023-06-20", activity: "Backend integration", time: 5 }
                ]
            },
            {
                id: 2,
                name: "Mobile App Development",
                description: "New iOS and Android app for product management",
                startDate: "2023-06-01",
                dueDate: "2023-09-15",
                status: "in-progress",
                priority: "medium",
                progress: 20,
                tasks: [
                    { id: 1, name: "Requirements gathering", completed: true, timeSpent: 8 },
                    { id: 2, name: "UI/UX design", completed: false, timeSpent: 15 },
                    { id: 3, name: "API development", completed: false, timeSpent: 10 },
                    { id: 4, name: "iOS development", completed: false, timeSpent: 0 },
                    { id: 5, name: "Android development", completed: false, timeSpent: 0 }
                ],
                activities: [
                    { date: "2023-06-05", activity: "Requirements finalized", time: 3 },
                    { date: "2023-06-08", activity: "Started UI design", time: 5 },
                    { date: "2023-06-12", activity: "UI design review", time: 2 },
                    { date: "2023-06-15", activity: "API planning", time: 4 }
                ]
            },
            {
                id: 3,
                name: "Marketing Campaign",
                description: "Summer product marketing campaign",
                startDate: "2023-05-01",
                dueDate: "2023-07-31",
                status: "on-hold",
                priority: "low",
                progress: 30,
                tasks: [
                    { id: 1, name: "Campaign strategy", completed: true, timeSpent: 10 },
                    { id: 2, name: "Content creation", completed: false, timeSpent: 8 },
                    { id: 3, name: "Social media setup", completed: false, timeSpent: 5 },
                    { id: 4, name: "Email campaign", completed: false, timeSpent: 0 }
                ],
                activities: [
                    { date: "2023-05-10", activity: "Strategy approved", time: 2 },
                    { date: "2023-05-15", activity: "Started content creation", time: 6 },
                    { date: "2023-05-20", activity: "Content review", time: 3 }
                ]
            }
        ];

        // DOM elements
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const projectList = document.getElementById('project-list');
        const addProjectBtn = document.getElementById('add-project-btn');
        const projectModal = document.getElementById('project-modal');
        const closeModalBtns = document.querySelectorAll('.close-modal');
        const projectForm = document.getElementById('project-form');
        const timePeriodBtns = document.querySelectorAll('.time-period-selector button');
        const customDateRange = document.getElementById('custom-date-range');
        const applyDateRangeBtn = document.getElementById('apply-date-range');
        const reportPeriodSelect = document.getElementById('report-period');
        const reportDateRange = document.getElementById('report-date-range');
        const previewReportBtn = document.getElementById('preview-report');
        const exportWordBtn = document.getElementById('export-word');
        const exportPdfBtn = document.getElementById('export-pdf');
        const exportCsvBtn = document.getElementById('export-csv');
        const reportPreview = document.getElementById('report-preview');
        const reportContent = document.getElementById('report-content');
        const reportModal = document.getElementById('report-modal');
        const fullReportContent = document.getElementById('full-report-content');
        const printReportBtn = document.getElementById('print-report');
        const downloadWordBtn = document.getElementById('download-word');
        const downloadPdfBtn = document.getElementById('download-pdf');

        // Current date for demo purposes
        const currentDate = new Date('2023-06-20');

        // Initialize the app
        function init() {
            loadProjects();
            updateDashboard('week');
            setupEventListeners();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });

            // Add project button
            addProjectBtn.addEventListener('click', () => {
                openProjectModal();
            });

            // Close modal buttons
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    projectModal.style.display = 'none';
                    reportModal.style.display = 'none';
                });
            });

            // Click outside modal to close
            window.addEventListener('click', (e) => {
                if (e.target === projectModal) {
                    projectModal.style.display = 'none';
                }
                if (e.target === reportModal) {
                    reportModal.style.display = 'none';
                }
            });

            // Project form submission
            projectForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveProject();
            });

            // Progress slider
            document.getElementById('project-progress').addEventListener('input', (e) => {
                const progress = e.target.value;
                document.getElementById('progress-visual').style.width = `${progress}%`;
                document.getElementById('progress-text').textContent = `${progress}%`;
            });

            // Time period buttons
            timePeriodBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    timePeriodBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    if (btn.dataset.period === 'custom') {
                        customDateRange.style.display = 'flex';
                    } else {
                        customDateRange.style.display = 'none';
                        updateDashboard(btn.dataset.period);
                    }
                });
            });

            // Apply custom date range
            applyDateRangeBtn.addEventListener('click', () => {
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;
                
                if (startDate && endDate) {
                    updateDashboard('custom', startDate, endDate);
                }
            });

            // Report period select change
            reportPeriodSelect.addEventListener('change', (e) => {
                if (e.target.value === 'custom') {
                    reportDateRange.style.display = 'flex';
                } else {
                    reportDateRange.style.display = 'none';
                }
            });

            // Preview report button
            previewReportBtn.addEventListener('click', () => {
                generateReportPreview();
            });

            // Export buttons
            exportWordBtn.addEventListener('click', () => {
                exportReport('word');
            });

            exportPdfBtn.addEventListener('click', () => {
                exportReport('pdf');
            });

            exportCsvBtn.addEventListener('click', () => {
                exportReport('csv');
            });

            // Print report button
            printReportBtn.addEventListener('click', () => {
                window.print();
            });
        }

        // Load projects into the project list
        function loadProjects() {
            projectList.innerHTML = '';
            
            if (projects.length === 0) {
                projectList.innerHTML = '<p>No projects found. Add a new project to get started.</p>';
                return;
            }
            
            projects.forEach(project => {
                const projectItem = document.createElement('div');
                projectItem.className = 'project-item';
                projectItem.innerHTML = `
                    <div class="project-info">
                        <h3>${project.name}</h3>
                        <p>${project.description}</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${project.progress}%"></div>
                        </div>
                        <small>Status: ${formatStatus(project.status)} | Priority: ${formatPriority(project.priority)}</small>
                    </div>
                    <div class="project-actions">
                        <button class="secondary edit-project" data-id="${project.id}">Edit</button>
                        <button class="danger delete-project" data-id="${project.id}">Delete</button>
                    </div>
                `;
                
                projectList.appendChild(projectItem);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-project').forEach(btn => {
                btn.addEventListener('click', () => {
                    const projectId = parseInt(btn.dataset.id);
                    openProjectModal(projectId);
                });
            });
            
            document.querySelectorAll('.delete-project').forEach(btn => {
                btn.addEventListener('click', () => {
                    const projectId = parseInt(btn.dataset.id);
                    deleteProject(projectId);
                });
            });
            
            // Update report project dropdown
            updateReportProjectDropdown();
        }

        // Format status for display
        function formatStatus(status) {
            const statusMap = {
                'not-started': 'Not Started',
                'in-progress': 'In Progress',
                'on-hold': 'On Hold',
                'completed': 'Completed'
            };
            return statusMap[status] || status;
        }

        // Format priority for display
        function formatPriority(priority) {
            const priorityMap = {
                'low': 'Low',
                'medium': 'Medium',
                'high': 'High'
            };
            return priorityMap[priority] || priority;
        }

        // Open project modal for adding or editing
        function openProjectModal(projectId = null) {
            const modalTitle = document.getElementById('modal-title');
            const form = document.getElementById('project-form');
            
            if (projectId) {
                // Edit mode
                modalTitle.textContent = 'Edit Project';
                const project = projects.find(p => p.id === projectId);
                
                if (project) {
                    document.getElementById('project-id').value = project.id;
                    document.getElementById('project-name').value = project.name;
                    document.getElementById('project-description').value = project.description;
                    document.getElementById('project-start-date').value = project.startDate;
                    document.getElementById('project-due-date').value = project.dueDate || '';
                    document.getElementById('project-status').value = project.status;
                    document.getElementById('project-priority').value = project.priority;
                    document.getElementById('project-progress').value = project.progress;
                    document.getElementById('progress-visual').style.width = `${project.progress}%`;
                    document.getElementById('progress-text').textContent = `${project.progress}%`;
                }
            } else {
                // Add mode
                modalTitle.textContent = 'Add New Project';
                form.reset();
                document.getElementById('project-id').value = '';
                document.getElementById('project-start-date').valueAsDate = new Date();
                document.getElementById('project-progress').value = 0;
                document.getElementById('progress-visual').style.width = '0%';
                document.getElementById('progress-text').textContent = '0%';
            }
            
            projectModal.style.display = 'block';
        }

        // Save project (add or update)
        function saveProject() {
            const projectId = document.getElementById('project-id').value;
            const projectData = {
                name: document.getElementById('project-name').value,
                description: document.getElementById('project-description').value,
                startDate: document.getElementById('project-start-date').value,
                dueDate: document.getElementById('project-due-date').value || null,
                status: document.getElementById('project-status').value,
                priority: document.getElementById('project-priority').value,
                progress: parseInt(document.getElementById('project-progress').value)
            };
            
            if (projectId) {
                // Update existing project
                const index = projects.findIndex(p => p.id === parseInt(projectId));
                if (index !== -1) {
                    projects[index] = { ...projects[index], ...projectData };
                }
            } else {
                // Add new project
                const newId = projects.length > 0 ? Math.max(...projects.map(p => p.id)) + 1 : 1;
                const newProject = {
                    id: newId,
                    tasks: [],
                    activities: [],
                    ...projectData
                };
                projects.push(newProject);
            }
            
            projectModal.style.display = 'none';
            loadProjects();
            updateDashboard();
        }

        // Delete project
        function deleteProject(projectId) {
            if (confirm('Are you sure you want to delete this project? This action cannot be undone.')) {
                projects = projects.filter(p => p.id !== projectId);
                loadProjects();
                updateDashboard();
            }
        }

        // Update dashboard with statistics
        function updateDashboard(period = 'week', startDate = null, endDate = null) {
            let dateRange = getDateRange(period, startDate, endDate);
            
            // Calculate statistics
            const totalProjects = projects.length;
            const activeProjects = projects.filter(p => p.status === 'in-progress').length;
            
            let hoursWorked = 0;
            let tasksCompleted = 0;
            
            projects.forEach(project => {
                // Calculate hours worked in the selected period
                if (project.activities) {
                    project.activities.forEach(activity => {
                        if (isDateInRange(activity.date, dateRange.start, dateRange.end)) {
                            hoursWorked += activity.time;
                        }
                    });
                }
                
                // Calculate completed tasks
                if (project.tasks) {
                    tasksCompleted += project.tasks.filter(t => t.completed).length;
                }
            });
            
            // Update dashboard stats
            document.getElementById('total-projects').textContent = totalProjects;
            document.getElementById('active-projects').textContent = activeProjects;
            document.getElementById('hours-worked').textContent = hoursWorked;
            document.getElementById('tasks-completed').textContent = tasksCompleted;
            
            // Update recent activity table
            updateRecentActivityTable(dateRange);
            
            // Update chart (simplified for this example)
            updateProgressChart();
        }

        // Get date range based on period
        function getDateRange(period, customStart, customEnd) {
            const today = new Date(currentDate);
            let startDate = new Date(currentDate);
            let endDate = new Date(currentDate);
            
            switch (period) {
                case 'day':
                    startDate.setDate(today.getDate() - 1);
                    break;
                case 'week':
                    startDate.setDate(today.getDate() - 7);
                    break;
                case 'month':
                    startDate.setMonth(today.getMonth() - 1);
                    break;
                case 'custom':
                    startDate = new Date(customStart);
                    endDate = new Date(customEnd);
                    break;
                default:
                    startDate.setDate(today.getDate() - 7);
            }
            
            return { start: startDate, end: endDate };
        }

        // Check if a date is within a range
        function isDateInRange(dateStr, startDate, endDate) {
            const date = new Date(dateStr);
            return date >= startDate && date <= endDate;
        }

        // Update recent activity table
        function updateRecentActivityTable(dateRange) {
            const activityTable = document.getElementById('recent-activity');
            activityTable.innerHTML = '';
            
            // Collect all activities from all projects
            let allActivities = [];
            projects.forEach(project => {
                if (project.activities) {
                    project.activities.forEach(activity => {
                        if (isDateInRange(activity.date, dateRange.start, dateRange.end)) {
                            allActivities.push({
                                date: activity.date,
                                project: project.name,
                                activity: activity.activity,
                                time: activity.time
                            });
                        }
                    });
                }
            });
            
            // Sort by date (newest first)
            allActivities.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Display up to 10 most recent activities
            const displayCount = Math.min(allActivities.length, 10);
            for (let i = 0; i < displayCount; i++) {
                const activity = allActivities[i];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(activity.date)}</td>
                    <td>${activity.project}</td>
                    <td>${activity.activity}</td>
                    <td>${activity.time} hours</td>
                `;
                activityTable.appendChild(row);
            }
            
            if (allActivities.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="4" style="text-align: center;">No activity found for the selected period</td>';
                activityTable.appendChild(row);
            }
        }

        // Format date for display
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        // Update progress chart (simplified for this example)
        function updateProgressChart() {
            const chartContainer = document.getElementById('progress-chart');
            
            // In a real app, you would use a charting library like Chart.js
            // This is a simplified placeholder
            chartContainer.innerHTML = `
                <h4 style="margin-top: 0;">Project Progress Overview</h4>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    ${projects.map(project => `
                        <div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>${project.name}</span>
                                <span>${project.progress}%</span>
                            </div>
                            <div style="height: 20px; background-color: #e0e0e0; border-radius: 10px; overflow: hidden;">
                                <div style="height: 100%; width: ${project.progress}%; background-color: #4a6fa5;"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Update report project dropdown
        function updateReportProjectDropdown() {
            const reportProjectSelect = document.getElementById('report-project');
            
            // Clear existing options except "All Projects"
            while (reportProjectSelect.options.length > 1) {
                reportProjectSelect.remove(1);
            }
            
            // Add projects to dropdown
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                reportProjectSelect.appendChild(option);
            });
        }

        // Generate report preview
        function generateReportPreview() {
            const projectId = document.getElementById('report-project').value;
            const period = document.getElementById('report-period').value;
            const detailLevel = document.getElementById('report-detail').value;
            
            let startDate, endDate;
            
            if (period === 'custom') {
                startDate = document.getElementById('report-start-date').value;
                endDate = document.getElementById('report-end-date').value;
                
                if (!startDate || !endDate) {
                    alert('Please select both start and end dates for custom range.');
                    return;
                }
            } else {
                const dateRange = getDateRange(period);
                startDate = dateRange.start;
                endDate = dateRange.end;
            }
            
            // Generate report content
            let reportHTML = '';
            
            if (projectId === 'all') {
                // Generate report for all projects
                reportHTML = generateAllProjectsReport(startDate, endDate, detailLevel);
            } else {
                // Generate report for a specific project
                const project = projects.find(p => p.id === parseInt(projectId));
                if (project) {
                    reportHTML = generateSingleProjectReport(project, startDate, endDate, detailLevel);
                }
            }
            
            // Display preview
            reportContent.innerHTML = reportHTML;
            reportPreview.style.display = 'block';
            
            // Also prepare full report for modal
            fullReportContent.innerHTML = reportHTML;
            reportModal.style.display = 'block';
        }

        // Generate report for all projects
        function generateAllProjectsReport(startDate, endDate, detailLevel) {
            let html = `
                <h2>Productivity Report for All Projects</h2>
                <p><strong>Date Range:</strong> ${formatDate(startDate)} to ${formatDate(endDate)}</p>
                
                <h3>Summary</h3>
                <table style="width: 100%; margin-bottom: 20px;">
                    <tr>
                        <th>Total Projects</th>
                        <th>Active Projects</th>
                        <th>Completed Projects</th>
                        <th>Total Hours Worked</th>
                    </tr>
                    <tr>
                        <td>${projects.length}</td>
                        <td>${projects.filter(p => p.status === 'in-progress').length}</td>
                        <td>${projects.filter(p => p.status === 'completed').length}</td>
                        <td>${calculateTotalHours(startDate, endDate)}</td>
                    </tr>
                </table>
            `;
            
            if (detailLevel === 'detailed') {
                html += `
                    <h3>Project Details</h3>
                    ${projects.map(project => `
                        <div style="margin-bottom: 30px; border-bottom: 1px solid #ddd; padding-bottom: 20px;">
                            <h4>${project.name}</h4>
                            <p>${project.description}</p>
                            <p><strong>Status:</strong> ${formatStatus(project.status)} | 
                               <strong>Priority:</strong> ${formatPriority(project.priority)} | 
                               <strong>Progress:</strong> ${project.progress}%</p>
                            
                            <h5>Tasks</h5>
                            <table style="width: 100%; margin-bottom: 15px;">
                                <tr>
                                    <th>Task</th>
                                    <th>Status</th>
                                    <th>Time Spent</th>
                                </tr>
                                ${project.tasks.map(task => `
                                    <tr>
                                        <td>${task.name}</td>
                                        <td>${task.completed ? 'Completed' : 'Pending'}</td>
                                        <td>${task.timeSpent} hours</td>
                                    </tr>
                                `).join('')}
                            </table>
                            
                            <h5>Recent Activities</h5>
                            <table style="width: 100%;">
                                <tr>
                                    <th>Date</th>
                                    <th>Activity</th>
                                    <th>Time</th>
                                </tr>
                                ${project.activities
                                    .filter(activity => isDateInRange(activity.date, startDate, endDate))
                                    .map(activity => `
                                    <tr>
                                        <td>${formatDate(activity.date)}</td>
                                        <td>${activity.activity}</td>
                                        <td>${activity.time} hours</td>
                                    </tr>
                                `).join('')}
                            </table>
                        </div>
                    `).join('')}
                `;
            }
            
            return html;
        }

        // Generate report for a single project
        function generateSingleProjectReport(project, startDate, endDate, detailLevel) {
            const activitiesInPeriod = project.activities.filter(activity => 
                isDateInRange(activity.date, startDate, endDate));
            
            const completedTasks = project.tasks.filter(t => t.completed);
            const pendingTasks = project.tasks.filter(t => !t.completed);
            
            let html = `
                <h2>Project Report: ${project.name}</h2>
                <p><strong>Date Range:</strong> ${formatDate(startDate)} to ${formatDate(endDate)}</p>
                
                <h3>Project Overview</h3>
                <table style="width: 100%; margin-bottom: 20px;">
                    <tr>
                        <th>Start Date</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Priority</th>
                        <th>Progress</th>
                    </tr>
                    <tr>
                        <td>${formatDate(project.startDate)}</td>
                        <td>${project.dueDate ? formatDate(project.dueDate) : 'Not set'}</td>
                        <td>${formatStatus(project.status)}</td>
                        <td>${formatPriority(project.priority)}</td>
                        <td>${project.progress}%</td>
                    </tr>
                </table>
                
                <p>${project.description}</p>
                
                <h3>Time Summary</h3>
                <p><strong>Total hours worked in period:</strong> ${activitiesInPeriod.reduce((sum, a) => sum + a.time, 0)}</p>
                <p><strong>Total hours worked on project:</strong> ${project.activities.reduce((sum, a) => sum + a.time, 0)}</p>
            `;
            
            if (detailLevel === 'detailed') {
                html += `
                    <h3>Tasks</h3>
                    <table style="width: 100%; margin-bottom: 20px;">
                        <tr>
                            <th>Task</th>
                            <th>Status</th>
                            <th>Time Spent</th>
                        </tr>
                        ${project.tasks.map(task => `
                            <tr>
                                <td>${task.name}</td>
                                <td>${task.completed ? 'Completed' : 'Pending'}</td>
                                <td>${task.timeSpent} hours</td>
                            </tr>
                        `).join('')}
                    </table>
                    
                    <h3>Activities in Period</h3>
                    <table style="width: 100%;">
                        <tr>
                            <th>Date</th>
                            <th>Activity</th>
                            <th>Time</th>
                        </tr>
                        ${activitiesInPeriod.map(activity => `
                            <tr>
                                <td>${formatDate(activity.date)}</td>
                                <td>${activity.activity}</td>
                                <td>${activity.time} hours</td>
                            </tr>
                        `).join('')}
                    </table>
                `;
            }
            
            return html;
        }

        // Calculate total hours worked across all projects in a date range
        function calculateTotalHours(startDate, endDate) {
            let totalHours = 0;
            
            projects.forEach(project => {
                project.activities.forEach(activity => {
                    if (isDateInRange(activity.date, startDate, endDate)) {
                        totalHours += activity.time;
                    }
                });
            });
            
            return totalHours;
        }

        // Export report to different formats
        function exportReport(format) {
            // In a real app, you would implement actual export functionality
            // This is a simplified simulation
            
            let message = '';
            
            switch (format) {
                case 'word':
                    message = 'Preparing Word document... Your download will start shortly.';
                    break;
                case 'pdf':
                    message = 'Generating PDF... Your download will start shortly.';
                    break;
                case 'csv':
                    message = 'Exporting data to CSV... Your download will start shortly.';
                    break;
                default:
                    message = 'Exporting report...';
            }
            
            alert(message);
            
            // In a real implementation, you might:
            // 1. For Word: Use a library like docx or generate HTML and convert to DOCX
            // 2. For PDF: Use a library like jsPDF or html2pdf
            // 3. For CSV: Generate CSV data and create a download link
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
